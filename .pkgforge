name 'iproute2'
org 'amylum'

licenses 'COPYING'

deps(
  iptables: {
    version: '1.6.1-9',
    checksum: '9320045850095a80d83e34e2473234fba7dbb02f3f0998618420a635d884ffaa'
  },
  libmnl: {
    version: '1.0.4-17',
    checksum: 'f22411343ad43f646bfcc9c86b99aec46cbb91f2cbd7b71bc9c6f7ec4edf8ad3'
  },
  'linux-api-headers': {
    version: '4.13-1',
    checksum: '50b2288419fe132c061bdf3d297293011929abc1092ffaa5e523ad6549b4f5fa'
  }
)

cflags
harden

patch 'iproute2-4.12.0-musl.patch'

build do
  configure
  run "sed 's|IPT_LIB_DIR:=.*|IPT_LIB_DIR:=#{dep(:iptables)}/usr/lib/iptables|' Config"
  make "CFLAGS" => "#{@forge.cflags.join(' ')}", "LDFLAGS" => "#{@forge.cflags.join(' ')}"
  install
  run "mv #{releasedir}/sbin #{releasedir}/usr/bin"
end

test do
  # TODO: add tests
end
